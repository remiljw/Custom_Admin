$(document).keyup(function(e){if(e.which===27){$('#btn').click();$('#btn_modal_order').click();$('#btn_modal_payment').click();$('#btn_modal_order_complete').click();$('#btn_modal_car_review').click();}});$('#btn').click(function(){$('#modal').fadeOut('slow');});$('#btn_modal_order').click(function(){$('#modal_order').fadeOut('slow');});$('#btn_modal_payment').click(function(){$('#modal_payment').fadeOut('slow');});$('#btn_modal_order_complete').click(function(){$('#modal_order_complete').fadeOut('slow');});$('#btn_modal_car_review').click(function(){$('#modal_car_review').fadeOut('slow');});$('a.delete').click(function(){$('article').fadeOut('slow');});;function cancel_order(pk){if(confirm('Are you sure you want to cancel the order?')){axios.defaults.headers.common['Authorization']='Token '
+localStorage.getItem('token');const url='http://localhost:8000/order/'+pk+'/cancel/';axios.put(url).then(r=>{location.reload();});}}
function get_orders(url,status){axios.defaults.headers.common['Authorization']='Token '
+localStorage.getItem('token');axios.get(url).then(r=>{$('div.box').hide();$('#not_found').hide();$('a.fillForm').hide();$('#order_data').hide();$('#rows').html('');const orders=r.data;let rows='';if(Object.keys(orders).length){$.each(orders,function(key,val){rows+='<tr><td id="order_id">'+val.id+'</td><td id="car_name">'+
val.car.model.name+' '+val.car.name+'</td><td>$<span id="total_price">'+
val.total_price+'</span></td><td>'+val.start_date+'</td><td>'+
val.end_date+'</td><td>';if(status==='pending'){rows+='<span class="tag is-danger">Pending</span></td><td><a href="#" class="delete"'+'onclick="cancel_order('+val.id+');">Cancel</a></td>';$('#th_cancel').show();}
else if(status==='active'){if(val.approved&&val.paid){$('#th_payment').hide();rows+='<span class="tag is-success"> Paid </span>';}
else{$('#order_pk').val(val.id);$('#th_payment').show();rows+='<span class="tag is-link" id="td_active">Active</span></td><td><a href="#" '+'onclick="$(\'#modal_payment\').show(\'slow\');" id="td_payment">'+'<span class="tag is-success">Pay via Card</span></a></td>';}}
else if(status==='canceled')
rows+='<span class="tag is-danger">Canceled</span></td>';else{$('#th_payment').show();rows+='<span class="tag is-success">Finished</span></td><td><a href="#" '+'onclick="$(\'#modal_car_review\').show(\'slow\');"><span id="rate_car_lbl" class="tag is-primary">'+'Rate the car</span></a></td>';}
rows+='</tr>';});$('#order_data').show();$('#rows').append(rows);$('#car').val($('#car_name').text()).attr('disabled','disabled');$('#order_rate_id').val($('#order_id').text());}
else
$('#not_found').show();});}
$('#pending_orders').click(function(){const url='http://localhost:8000/order/get-orders/';get_orders(url,'pending');});$('#active_orders').click(function(){const url='http://localhost:8000/order/get-orders/?active=True';get_orders(url,'active');});$('#canceled_orders').click(function(){const url='http://localhost:8000/order/get-orders/?canceled=True';get_orders(url,'canceled');});$('#finished_orders').click(function(){const url='http://localhost:8000/order/get-orders/?finished=True';get_orders(url,'finished');});$('#checkout').click(function(){$('#payment_error').hide();const card={name:$('#card_name').val(),number:$('#card_number').val(),exp_month:$('#expiry_month').val(),exp_year:$('#expiry_year').val(),cvc:$('#cvv').val()};Stripe.createToken(card,function(status,r){if(status===200){const pk=$('#order_pk').val();const url='http://localhost:8000/order/'+pk+'/payment/';const data={'stripe_id':r.id,'total_price':$('#total_price').text()};axios.post(url,data).then(r=>{$('#modal_payment').hide();$('#modal_order_complete').show();})}
else
$('#payment_error').show('slow');});});;$('#car_rate').click(function(){axios.defaults.headers.common['Authorization']='Token '
+localStorage.getItem('token');const pk=$('#order_rate_id').val();const data={'rate':$('#rate').val()};const url='http://localhost:8000/order/'+pk+'/rate-car/';axios.put(url,data).then(r=>{if(r.data.rated)
alert('You rated the car successfully!');location.reload();});});;